<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LED Strip Controls</title>
  <link rel="icon" type="image/png" sizes="192x192" href="{{ url_for('static', filename='icons/icon-192.png') }}">
  <link rel="apple-touch-icon" sizes="512x512" href="{{ url_for('static', filename='icons/icon-512.png') }}">
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #ffffff; color: #000000; margin:0; padding:0; }
    .sidebar { height:100%; width:0; position:fixed; top:0; left:0; background:#d2b48c; overflow-x:hidden; transition:0.3s; padding-top:60px; z-index:1000; }
    .sidebar a { padding:12px 24px; text-decoration:none; font-size:18px; color:#000; display:block; transition:0.3s; }
    .sidebar a:hover { background-color:#b08d5c; }
    .openbtn { font-size:26px; cursor:pointer; background-color:#d2b48c; color:#000; padding:10px 20px; border:none; border-radius:0 0 8px 0; position:fixed; top:0; left:0; z-index:1100; }
    .main-content { margin-left:0; transition:0.3s; padding:40px; }
    h1 { text-align:center; margin-bottom:30px; }
    .slider-section { max-width:600px; margin:0 auto; display:flex; flex-direction:column; gap:20px; }
    .slider-container { display:flex; align-items:center; justify-content:space-between; gap:15px; }
    .slider-container label { width:60px; font-weight:bold; }
    input[type="range"] { flex-grow:1; }
    button { background-color:#d2b48c; color:#000; border:none; padding:10px 16px; border-radius:6px; cursor:pointer; font-size:14px; transition:0.2s; }
    button:hover { background-color:#b08d5c; }

    /* --- New UI elements --- */
    .status-section { display:flex; justify-content:center; align-items:center; gap:20px; margin-bottom:25px; }
    .indicator { width:20px; height:20px; border-radius:50%; background-color:red; border:1px solid #444; }

    .bottom-section { display:flex; justify-content:center; align-items:flex-start; gap:20px; margin-top:25px; }
    .color-display { width:100px; height:100px; border-radius:50%; border:1px solid #ccc; }
    .terminal { background:#fff; color:#000; font-family:monospace; padding:10px; border-radius:6px; max-width:450px; height:120px; overflow-y:auto; font-size:13px; border:1px solid #ccc; }
  </style>
</head>
<body>
<div id="mySidebar" class="sidebar">
  <a href="javascript:void(0)" onclick="closeNav()">✖ Close</a>
  <a href="{{ url_for('index') }}">Manual Command</a>
  <a href="{{ url_for('terminal') }}">Terminal</a>
  <a href="{{ url_for('led_controls') }}">LED Controls</a>
</div>

<button class="openbtn" onclick="openNav()">☰</button>

<div class="main-content">
  <!-- Header image -->
  <img src="{{ url_for('static', filename='led.png') }}" alt="LED Header" style="width:100%; max-height:300px; object-fit:cover; border-radius:8px; margin-bottom:30px;">

  <h1>LED Strip Controls</h1>

  <!-- Status and Toggles moved above sliders -->
  <div class="status-section">
    <div class="indicator" id="connIndicator"></div>
    <button onclick="toggleConnection()" id="connBtn">Connect</button>
    <button onclick="togglePower()" id="powerBtn">Turn Off</button>
  </div>

  <div class="slider-section">
    <div class="slider-container"><label>Red</label><input type="range" id="redSlider" min="0" max="255" value="0" oninput="updateColorDisplay()"><span id="redVal">0</span></div>
    <div class="slider-container"><label>Green</label><input type="range" id="greenSlider" min="0" max="255" value="0" oninput="updateColorDisplay()"><span id="greenVal">0</span></div>
    <div class="slider-container"><label>Blue</label><input type="range" id="blueSlider" min="0" max="255" value="0" oninput="updateColorDisplay()"><span id="blueVal">0</span></div>
    <div class="slider-container"><label>Brightness</label><input type="range" id="brightnessSlider" min="1" max="16" value="16" oninput="updateColorDisplay()"><span id="brightnessVal">16</span></div>

    <div style="text-align:center; margin-top:15px;">
      <button onclick="sendLEDCommand()">Set Color</button>
    </div>
  </div>

  <!-- New bottom section: circle + terminal -->
  <div class="bottom-section">
    <div class="color-display" id="colorDisplay"></div>
    <div class="terminal" id="terminal"></div>
  </div>
</div>

<script>
function openNav(){document.getElementById("mySidebar").style.width="200px";document.querySelector(".main-content").style.marginLeft="200px";}
function closeNav(){document.getElementById("mySidebar").style.width="0";document.querySelector(".main-content").style.marginLeft="0";}

function updateColorDisplay(){
  const r=parseInt(document.getElementById('redSlider').value),
        g=parseInt(document.getElementById('greenSlider').value),
        b=parseInt(document.getElementById('blueSlider').value),
        br=parseInt(document.getElementById('brightnessSlider').value);
  document.getElementById('redVal').textContent=r;
  document.getElementById('greenVal').textContent=g;
  document.getElementById('blueVal').textContent=b;
  document.getElementById('brightnessVal').textContent=br;
  const scaledR=Math.round(r*(br/16)),
        scaledG=Math.round(g*(br/16)),
        scaledB=Math.round(b*(br/16));
  document.getElementById('colorDisplay').style.backgroundColor=`rgb(${scaledR},${scaledG},${scaledB})`;
}

async function sendLEDCommand(){
  const r=parseInt(document.getElementById('redSlider').value),
        g=parseInt(document.getElementById('greenSlider').value),
        b=parseInt(document.getElementById('blueSlider').value),
        br=parseInt(document.getElementById('brightnessSlider').value),
        scaledR=Math.round(r*(br/16)),
        scaledG=Math.round(g*(br/16)),
        scaledB=Math.round(b*(br/16)),
        cmd=`LED:${scaledR},${scaledG},${scaledB}`;
  await fetch("/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:cmd})});
  logToTerminal("Sent: " + cmd);
}

/* ---- Connection + Power ---- */
let isConnected=false;
let powerOn=true;

function toggleConnection(){
  isConnected=!isConnected;
  document.getElementById("connIndicator").style.backgroundColor=isConnected?"green":"red";
  document.getElementById("connBtn").textContent=isConnected?"Disconnect":"Connect";
  logToTerminal(isConnected?"Connected to LED strip":"Disconnected from LED strip");
}

function togglePower(){
  powerOn=!powerOn;
  document.getElementById("powerBtn").textContent=powerOn?"Turn Off":"Turn On";
  const cmd=powerOn?"POWER:ON":"POWER:OFF";
  logToTerminal("Sent: " + cmd);
  fetch("/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:cmd})});
}

/* ---- Terminal logger ---- */
function logToTerminal(msg){
  const term=document.getElementById("terminal");
  const line=document.createElement("div");
  line.textContent=msg;
  term.appendChild(line);
  term.scrollTop=term.scrollHeight;
}

updateColorDisplay();
</script>
</body>
</html>