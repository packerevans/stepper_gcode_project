<!DOCTYPE html>
<html>
<head>
    <title>Sand Table Smart Concentric Fill</title>
    <style>
        body { font-family: sans-serif; background: #333; color: white; text-align: center; }
        canvas { background: #eee; border-radius: 4px; margin-top: 20px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        button:hover { background: #0056b3; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-clipper/1.0.1/clipper.js"></script>
</head>
<body>

    <h2>Smart Concentric Fill (Offset Texture)</h2>
    <p>This respects holes (eyes) and complex edges (mane).</p>
    <button onclick="generateTexture()">Generate Texture</button><br>
    <canvas id="sandCanvas" width="600" height="600"></canvas>

    <script>
        // 1. SCALING IS CRITICAL
        // Clipper works with Integers, so we must scale coordinates up and then back down.
        const SCALE = 1000; 
        
        // 2. Define the Shape (A simplified Lion-ish shape with a hole)
        // In your real code, this comes from your uploaded file parsing.
        const lionShape = [
            {X: 100, Y: 100}, {X: 500, Y: 100}, {X: 500, Y: 500}, 
            {X: 300, Y: 550}, {X: 100, Y: 500} // Outer Mane
        ];
        
        const lionEyeLeft = [
            {X: 200, Y: 200}, {X: 250, Y: 200}, {X: 250, Y: 250}, {X: 200, Y: 250} // Hole
        ];

        const lionEyeRight = [
            {X: 350, Y: 200}, {X: 400, Y: 200}, {X: 400, Y: 250}, {X: 350, Y: 250} // Hole
        ];

        function drawPoly(ctx, path, color, width) {
            if (path.length === 0) return;
            ctx.beginPath();
            ctx.moveTo(path[0].X / SCALE, path[0].Y / SCALE);
            for (var i = 1; i < path.length; i++) {
                ctx.lineTo(path[i].X / SCALE, path[i].Y / SCALE);
            }
            ctx.closePath();
            ctx.strokeStyle = color;
            ctx.lineWidth = width;
            ctx.stroke();
        }

        function generateTexture() {
            const canvas = document.getElementById('sandCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // --- STEP A: PREPARE CLIPPER ---
            var cpr = new ClipperLib.ClipperOffset();
            
            // Convert simple objects to Clipper Paths and scale them up
            var mainPath = lionShape.map(p => ({X: p.X * SCALE, Y: p.Y * SCALE}));
            var hole1 = lionEyeLeft.map(p => ({X: p.X * SCALE, Y: p.Y * SCALE}));
            var hole2 = lionEyeRight.map(p => ({X: p.X * SCALE, Y: p.Y * SCALE}));

            // Add Paths to the Offsetter
            // JoinType: jtMiter (sharp), jtRound (rounded corners), jtSquare (squared)
            // EndType: etClosedPolygon (since these are closed shapes)
            cpr.AddPath(mainPath, ClipperLib.JoinType.jtRound, ClipperLib.EndType.etClosedPolygon);
            cpr.AddPath(hole1, ClipperLib.JoinType.jtRound, ClipperLib.EndType.etClosedPolygon);
            cpr.AddPath(hole2, ClipperLib.JoinType.jtRound, ClipperLib.EndType.etClosedPolygon);

            // --- STEP B: GENERATE OFFSETS (The Loop) ---
            var offset_step = -10.0 * SCALE; // 10px spacing, negative moves INWARDS
            var current_offset = 0;
            var solution_paths = [];

            // We loop "inward" until the shape disappears
            // Usually 50-100 loops is enough to fill any shape, or break when empty
            for(let i=0; i<100; i++) {
                var solution = new ClipperLib.Paths();
                cpr.Execute(solution, current_offset);
                
                if (solution.length === 0) break; // We reached the center, stop.

                solution_paths.push(solution);
                current_offset += offset_step; // Shrink further next time
            }

            // --- STEP C: DRAW RESULTS ---
            // Draw the generated texture lines
            solution_paths.forEach(group => {
                group.forEach(path => {
                    drawPoly(ctx, path, '#0055ff', 2);
                });
            });
        }
    </script>
</body>
</html>
