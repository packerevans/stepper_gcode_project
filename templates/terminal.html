<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Terminal Control</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        body { background: white; margin: 0; font-family: sans-serif; }
        .container { padding: 20px; }
        .slider-container { margin: 20px 0; }
        .terminal-window {
            background: black;
            color: lime;
            font-family: monospace;
            padding: 10px;
            height: 300px;
            overflow-y: auto;
            border-radius: 8px;
        }
        .btn { padding: 8px 12px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <!-- Slide Menu (copied from index.html) -->
    <div class="menu">
        <a href="{{ url_for('index') }}">Home</a>
        <a href="{{ url_for('terminal') }}">Terminal</a>
    </div>

    <div class="container">
        <h2>Arduino Control</h2>

        <!-- Arm slider -->
        <div class="slider-container">
            <label>Arm: <span id="armValue">1500</span></label>
            <input type="range" id="armSlider" min="0" max="3000" value="1500">
            <button class="btn" onclick="sendCommand('ARM:' + document.getElementById('armSlider').value)">Send</button>
        </div>

        <!-- Base slider -->
        <div class="slider-container">
            <label>Base: <span id="baseValue">1500</span></label>
            <input type="range" id="baseSlider" min="0" max="3000" value="1500">
            <button class="btn" onclick="sendCommand('BASE:' + document.getElementById('baseSlider').value)">Send</button>
        </div>

        <!-- Reboot button -->
        <div>
            <button class="btn" onclick="rebootPi()">Reboot Raspberry Pi</button>
        </div>

        <!-- Terminal output -->
        <h3>Serial Output</h3>
        <div id="terminal" class="terminal-window"></div>
    </div>

    <script>
        // Update slider values live
        document.getElementById('armSlider').oninput = function() {
            document.getElementById('armValue').innerText = this.value;
        };
        document.getElementById('baseSlider').oninput = function() {
            document.getElementById('baseValue').innerText = this.value;
        };

        // Send command
        function sendCommand(cmd) {
            fetch("/send", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ command: cmd })
            });
        }

        // Reboot Pi
        function rebootPi() {
            fetch("/reboot", { method: "POST" });
        }

        // Terminal logs updater
        async function updateLogs() {
            const res = await fetch("/terminal/logs");
            const data = await res.json();
            const term = document.getElementById("terminal");
            term.innerHTML = data.join("<br>");
            term.scrollTop = term.scrollHeight; // auto-scroll
        }
        setInterval(updateLogs, 1000);
    </script>
</body>
</html>
